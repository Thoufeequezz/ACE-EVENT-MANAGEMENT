<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>

    <!-- Clerk SDK -->
    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="<%= clerkKey %>"
      src="https://present-frog-22.clerk.accounts.dev/npm/@clerk/clerk-js@5/dist/clerk.browser.js"
      type="text/javascript">
    </script>

    <!-- Tailwind + Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    <!-- CSS -->
    <link rel="stylesheet" href="/css/main.css">

  </head>

  <body id="home" class="bg-gray-900 text-gray-100">
    <!-- Navbar -->
    <nav class="bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
      <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
        <a onclick="document.getElementById('home').scrollIntoView({ behavior: 'smooth' })">
          <img src="<%= logoPath %>" alt="ACE Logo" class="h-14 w-auto scale-125 logo-white">
        </a>
        <ul class="hidden md:flex space-x-8 font-medium">
          <% navItems.forEach(item => { %>
            <li><a href="<%= item.href %>" class="hover:text-purple-400 transition" id="<%= item.id %>" onclick=<%= item.func %>><%= item.text %></a></li>
          <% }) %>
        </ul>

        <!-- Auth Area -->
        <div class="hidden md:flex space-x-4 items-center">
          <div id="clerk-user-button" ></div>
        </div>
        <button class="md:hidden text-gray-100 focus:outline-none">☰</button>
      </div>
    </nav>

    <!-- Mobile Side Navbar -->
    <div id="mobile-sidenav" class="fixed top-0 left-[-100%] w-64 h-full bg-gray-900 shadow-lg z-50 transition-left duration-300">
        <div class="p-6 flex justify-between items-center border-b border-gray-800">
            <h2 class="text-xl font-bold">ACE</h2>
            <button id="close-sidenav" class="text-gray-100 focus:outline-none text-2xl">&times;</button>
        </div>
        <div class="mt-6 px-8">
          <div id="clerk-user-button-mobile" ></div>
        </div>
        <ul class="mt-6 flex flex-col gap-4 px-4">
            <% navItems.forEach(item => { %>
            <li><a href="<%= item.href %>" class="block py-2 px-3 rounded hover:bg-gray-800" onclick=<%= item.func %>><%= item.text %></a></li>
            <% }) %>
        </ul>
    </div>

    <div id = "hide_for_dash">
      <!-- Hero / Slider -->
      <section class="relative h-[500px] flex items-center justify-center overflow-hidden">
          <% heroSlides.forEach((slide, i) => { %>
          <img src="<%= slide %>" class="hero-slide <%= i === 0 ? 'active' : '' %>" alt="slide<%= i+1 %>">
          <% }) %>
          <div class="absolute inset-0 bg-gradient-to-b from-black/70 to-transparent"></div>
          <div class="relative text-center px-6">
          <h1 class="text-4xl md:text-6xl font-bold mb-4"><%= heroTitle %></h1>
          <p class="text-lg md:text-xl mb-6 text-gray-300"><%= heroSubtitle %></p>
          <div class="space-x-4">
              <button class="glossy-btn" onclick="document.getElementById('events').scrollIntoView({ behavior: 'smooth' })"> <%= heroBtn1 %> </button>
              <button class="glossy-btn-outline"><%= heroBtn2 %></button>
          </div>
          </div>
      </section>

        <!-- Events Section -->
        <section id="events" class="max-w-7xl mx-auto my-16 px-6">
          <h2 class="text-3xl font-bold mb-8 text-center">Featured Events</h2>
          <div class="grid md:grid-cols-3 gap-8">
              <% events.forEach(event => { %>
              <div class="bg-gray-800 rounded-2xl shadow-lg overflow-hidden hover:shadow-xl hover:scale-105 transition">
                  <img src="<%= event.IMAGE || 'event_images/default.png' %>" 
                      class="w-full h-48 object-cover" 
                      alt="<%= event.TITLE %>">
                  <div class="p-5">
                  <h3 class="text-xl font-semibold mb-2"><%= event.TITLE %></h3>
                  <p class="text-gray-300 mb-4">
                      Fee: <%= event.FEE === 0 ? "FREE" : "₹" + event.FEE %> | Status: <%= event.EVENTSTATUS %>
                  </p>
                  <p class="text-gray-300 mb-4">
                      Date: <%= new Date(event.STARTDATE).toLocaleDateString() %> - <%= new Date(event.ENDDATE).toLocaleDateString() %>
                  </p>
                  <p class="text-gray-300 mb-4">
                      Venue: <%= event.VENUE %> | Type: <%= event.EVENTTYPE %>
                  </p>
                  <button
                    class="glossy-btn w-full view-btn"
                    data-title="<%= event.TITLE %>"
                    data-desc="<%= event.DESCRIPTION %>"
                    data-image="<%= event.IMAGE || 'event_images/default.png' %>"
                    data-fee="<%= event.FEE %>"
                    data-start="<%= new Date(event.STARTDATE).toLocaleDateString() %>"
                    data-end="<%= new Date(event.ENDDATE).toLocaleDateString() %>"
                    data-venue="<%= event.VENUE %>"
                    data-type="<%= event.EVENTTYPE %>"
                  >
                    View Details
                  </button>
                  </div>
              </div>
              <% }) %>
          </div>
        </section>

        <!-- Modern Event Modal -->
        <div id="eventModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 overflow-auto">
          <div class="max-w-3xl mx-auto my-16 bg-gray-900 rounded-3xl shadow-2xl overflow-hidden relative p-8 flex flex-col">
            
            <!-- Close Button -->
            <button id="closeModal" class="absolute top-4 right-4 text-gray-200 text-3xl hover:text-white z-50">&times;</button>

            <!-- Event Content -->
            <div class="flex flex-col gap-6">
              <h2 id="modalTitle" class="text-4xl font-bold text-gray-100"></h2>
              <p id="modalDesc" class="text-gray-300 leading-relaxed text-lg max-h-[400px] overflow-y-auto"></p>

              <div class="text-gray-400 space-y-2">
                <p id="modalFee"></p>
                <p id="modalDate"></p>
                <p id="modalVenue"></p>
              </div>

              <button id="registerBtn" class="glossy-btn w-full py-3 text-lg font-semibold hover:scale-105 transition-transform">
                Register
              </button>
            </div>
          </div>
        </div>

        <!-- About -->
        <section id="about" class="bg-gray-800 py-16">
            <div class="max-w-6xl mx-auto px-6 text-center">
            <h2 class="text-3xl font-bold mb-6">About Us</h2>
            <p class="text-gray-400 max-w-2xl mx-auto"><%= aboutText %></p>
            </div>
        </section>

        <!-- Contact -->
        <section id="contact" class="bg-gray-900 py-16">
            <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-3xl font-bold mb-6 text-center">Contact Us</h2>
            <form class="max-w-2xl mx-auto space-y-4" method="post" action="/contact">
                <input type="text" name="name" placeholder="Your Name" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-100">
                <input type="email" name="email" placeholder="Your Email" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-100">
                <textarea name="message" rows="4" placeholder="Your Message" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-100"></textarea>
                <button class="glossy-btn w-full">Send Message</button>
            </form>
            </div>
        </section>

        <!-- Logged-in User Info -->
        <div id="userInfo" class="max-w-7xl mx-auto px-6 py-4 text-center text-gray-300 hidden">
          Logged in as: <span id="userId"></span>
        </div>

        <footer class="bg-gray-950 text-gray-400 py-6 text-center border-t border-gray-800">
            <p>&copy; <%= new Date().getFullYear() %> ACE - Association of CSE. All rights reserved.</p>
        </footer>
    </div>

    <!-- Admin Dashboard -->
    <div id="dashboardDiv" class="hidden bg-gray-800 text-gray-100 p-8">
      <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>

      <!-- Quick Stats -->
      <div class="grid md:grid-cols-3 gap-6 mb-10">
          <div class="bg-gray-900 rounded-xl p-6 shadow hover:shadow-lg">
            <h2 class="text-xl font-semibold mb-2">Total Events</h2>
            <p id="dashTotalEvents" class="text-3xl font-bold"><%= totalEvents %></p>
          </div>
          <div class="bg-gray-900 rounded-xl p-6 shadow hover:shadow-lg">
            <h2 class="text-xl font-semibold mb-2">Total Registrations</h2>
            <p id="dashTotalRegs" class="text-3xl font-bold"><%= totalReg %></p>
          </div>
          <div class="bg-gray-900 rounded-xl p-6 shadow hover:shadow-lg">
            <h2 class="text-xl font-semibold mb-2">Subscribers</h2>
            <p id="dashTotalUsers" class="text-3xl font-bold"><%= totalUsers %></p>
          </div>
      </div>
      
      <!-- Event Management -->
      <div class="mb-12">
          <h2 class="text-2xl font-bold mb-4">Manage Events</h2>
          <button class="glossy-btn mb-4" onclick="openAddEventModal()">Add New Event</button>
          <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-700">
                <th class="p-3">Title</th>
                <th class="p-3">Start</th>
                <th class="p-3">End</th>
                <th class="p-3">Status</th>
                <th class="p-3"></th>
                <th class="p-3"></th> 
                </tr>
            </thead>
            <tbody id="dashEventsTable">
            </tbody>
            </table>
          </div>
      </div>

      <!-- Registered Users Viewer -->
      <div class="mb-12 bg-gray-900 rounded-2xl p-6 shadow-lg">
        <h2 class="text-3xl font-bold mb-6 text-white text-left border-b border-gray-700 pb-3">
          Registrations by Event
        </h2>

        <!-- Event Selector -->
        <div class="mb-6">
          <select id="dashEventSelector" class="w-full p-3 rounded-lg bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
            <option value="" disabled selected>Select an Event</option>
          </select>
        </div>

        <!-- Registrations List -->
        <ul id="dashRegistrations" class="space-y-3 max-h-96 overflow-y-auto border-t border-gray-700 pt-3">
          <!-- Example item (will be generated dynamically) -->
          <!--
          <li class="bg-gray-800 p-4 rounded-lg flex justify-between items-center hover:bg-gray-700 transition">
            <span class="font-medium text-gray-100">John Doe (CSE, Sem 4)</span>
            <span class="text-gray-400">#12345</span>
          </li>
          -->
        </ul>

        <!-- Optional: Empty state -->
        <p id="registrationsEmpty" class="text-gray-400 text-center mt-4 hidden">Select an event to see registrations.</p>
      </div>
      
    </div>

    <!-- Add New Event Modal -->
    <div id="addEventModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden z-50 flex items-center justify-center">
      <div class="bg-gray-900 w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl p-8 relative animate-fadeIn">

        <!-- Close button -->
        <button onclick="closeAddEventModal()" class="absolute top-4 right-6 text-gray-400 hover:text-white text-3xl font-bold">&times;</button>

        <h2 class="text-3xl font-bold mb-8 text-center text-white">Add New Event</h2>

        <form id="addEventForm" class="space-y-6" enctype="multipart/form-data">

          <!-- Title -->
          <div>
            <label for="title" class="block mb-1 text-gray-200 font-semibold">Event Title</label>
            <input id="title" name="title" type="text"
                  placeholder="e.g. Tech Fest 2025"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block mb-1 text-gray-200 font-semibold">Description</label>
            <textarea id="description" name="description" rows="4"
                      placeholder="Note: Please provide a detailed description of the event, including all rules and regulations."
                      class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required></textarea>
          </div>

          <!-- Fee -->
          <div>
            <label for="fee" class="block mb-1 text-gray-200 font-semibold">Fee</label>
            <input id="fee" name="fee" type="number"
                  placeholder="e.g. 100"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Dates -->
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="startDate" class="block mb-1 text-gray-200 font-semibold">Start Date</label>
              <input id="startDate" name="startDate" type="date"
                    class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
            </div>
            <div>
              <label for="endDate" class="block mb-1 text-gray-200 font-semibold">End Date</label>
              <input id="endDate" name="endDate" type="date"
                    class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
            </div>
          </div>

          <!-- Venue -->
          <div>
            <label for="venue" class="block mb-1 text-gray-200 font-semibold">Venue</label>
            <input id="venue" name="venue" type="text"
                  placeholder="e.g. Main Auditorium"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Event Type -->
          <div>
            <label for="type" class="block mb-1 text-gray-200 font-semibold">Event Type</label>
            <input id="type" name="type" type="text" placeholder="e.g. Workshop, Seminar, Festival" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Image Upload + Preview -->
          <div>
            <label class="block mb-2 text-gray-200 font-semibold">Event Image</label>

            <div class="flex flex-col md:flex-row md:space-x-6 space-y-6 md:space-y-0 items-center">
              <!-- Drop Zone -->
              <div id="dropZone"
                  class="flex flex-col items-center justify-center w-full md:w-1/2 h-40 border-2 border-dashed border-gray-600 rounded-xl cursor-pointer bg-gray-800 hover:bg-gray-700 transition text-center">
                <svg class="w-12 h-12 mb-2 text-gray-400" fill="none" stroke="currentColor" stroke-width="2"
                    viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M7 16V4a1 1 0 011-1h8a1 1 0 011 1v12m-4-4l-4 4h8l-4-4z"/>
                </svg>
                <p class="text-gray-300"><span class="font-semibold">Drag & Drop</span> or Click to Upload</p>
                <p class="text-gray-400 text-sm">PNG, JPG up to 5 MB</p>
                <input id="image" name="image" type="file" accept="image/*" class="hidden">
              </div>

              <!-- Always-visible Preview -->
              <div id="imagePreview" class="w-full md:w-1/2 flex items-center justify-center">
                <img src="https://68d345140c01626cd941b210--incandescent-blancmange-27e8c3.netlify.app/ace_email_logo.png"
                    alt="Preview"
                    class="max-h-40 rounded-xl shadow-lg border border-gray-700 object-cover" />
              </div>
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex justify-end space-x-4 pt-4">
            <button type="button" onclick="closeAddEventModal()"
                    class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg">Cancel</button>
            <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-500 px-5 py-2 rounded-lg">Add Event</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden z-50 flex items-center justify-center">
      <div class="bg-gray-900 w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl p-8 relative animate-fadeIn">

        <!-- Close button -->
        <button onclick="closeEditEventModal()" class="absolute top-4 right-6 text-gray-400 hover:text-white text-3xl font-bold">&times;</button>

        <h2 class="text-3xl font-bold mb-8 text-center text-white">Edit Event</h2>

        <form id="editEventForm" class="space-y-6" enctype="multipart/form-data">

          <!-- Hidden Event ID -->
          <input type="hidden" id="editEventId" name="eventId">

          <!-- Title -->
          <div>
            <label for="editTitle" class="block mb-1 text-gray-200 font-semibold">Event Title</label>
            <input id="editTitle" name="title" type="text"
                  placeholder="e.g. Tech Fest 2025"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Description -->
          <div>
            <label for="editDescription" class="block mb-1 text-gray-200 font-semibold">Description</label>
            <textarea id="editDescription" name="description" rows="4"
                      placeholder="Enter detailed event description"
                      class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required></textarea>
          </div>

          <!-- Fee -->
          <div>
            <label for="editFee" class="block mb-1 text-gray-200 font-semibold">Fee</label>
            <input id="editFee" name="fee" type="number"
                  placeholder="e.g. 100"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Dates -->
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="editStartDate" class="block mb-1 text-gray-200 font-semibold">Start Date</label>
              <input id="editStartDate" name="startDate" type="date"
                    class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
            </div>
            <div>
              <label for="editEndDate" class="block mb-1 text-gray-200 font-semibold">End Date</label>
              <input id="editEndDate" name="endDate" type="date"
                    class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
            </div>
          </div>

          <!-- Venue -->
          <div>
            <label for="editVenue" class="block mb-1 text-gray-200 font-semibold">Venue</label>
            <input id="editVenue" name="venue" type="text"
                  placeholder="e.g. Main Auditorium"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Event Type -->
          <div>
            <label for="editType" class="block mb-1 text-gray-200 font-semibold">Event Type</label>
            <input id="editType" name="type" type="text"
                  placeholder="e.g. Workshop, Seminar, Festival"
                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-indigo-500" required>
          </div>

          <!-- Image Upload + Preview -->
          <div>
            <label class="block mb-2 text-gray-200 font-semibold">Event Image</label>

            <div class="flex flex-col md:flex-row md:space-x-6 space-y-6 md:space-y-0 items-center">
              <!-- Drop Zone -->
              <div id="editDropZone"
                  class="flex flex-col items-center justify-center w-full md:w-1/2 h-40 border-2 border-dashed border-gray-600 rounded-xl cursor-pointer bg-gray-800 hover:bg-gray-700 transition text-center">
                <svg class="w-12 h-12 mb-2 text-gray-400" fill="none" stroke="currentColor" stroke-width="2"
                    viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M7 16V4a1 1 0 011-1h8a1 1 0 011 1v12m-4-4l-4 4h8l-4-4z"/>
                </svg>
                <p class="text-gray-300"><span class="font-semibold">Drag & Drop</span> or Click to Upload</p>
                <p class="text-gray-400 text-sm">PNG, JPG up to 5 MB</p>
                <input id="editImage" name="image" type="file" accept="image/*" class="hidden">
              </div>

              <!-- Image Preview -->
              <div id="editImagePreview" class="w-full md:w-1/2 flex items-center justify-center">
                <img src="https://68d345140c01626cd941b210--incandescent-blancmange-27e8c3.netlify.app/ace_email_logo.png"
                    alt="Preview"
                    class="max-h-40 rounded-xl shadow-lg border border-gray-700 object-cover" />
              </div>
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex justify-end space-x-4 pt-4">
            <button type="button" onclick="closeEditEventModal()"
                    class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg">Cancel</button>
            <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-500 px-5 py-2 rounded-lg">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Alert Overlay -->
    <div id="alertOverlay" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
      <div id="alertBox" class="bg-gray-800 text-gray-100 p-6 rounded-2xl shadow-xl text-center max-w-sm w-full">
        <h3 id="alertTitle" class="text-xl font-semibold mb-2">Alert</h3>
        <p id="alertMessage" class="text-gray-300 mb-4">This is a sample message.</p>
        <button id="alertClose" class="glossy-btn px-4 py-2">OK</button>
      </div>
    </div>

    <!-- Confirm Overlay -->
    <div id="confirmOverlay" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
      <div id="confirmBox" class="bg-gray-800 text-gray-100 p-6 rounded-2xl shadow-xl text-center max-w-sm w-full">
        <h3 id="confirmTitle" class="text-xl font-semibold mb-2">Confirm</h3>
        <p id="confirmMessage" class="text-gray-300 mb-4">Are you sure?</p>
        <div class="flex justify-center gap-4">
          <button id="confirmYes" class="glossy-btn px-4 py-2">Yes</button>
          <button id="confirmNo" class="glossy-btn-outline px-4 py-2">No</button>
        </div>
      </div>
    </div>

    <script src="javascript/admin/dashboard.js"></script>
    <script type="module">
      import { setupImagePreview } from '/javascript/admin/preview_img.js';

      // For Add Event modal
      setupImagePreview('dropZone', 'image', '#imagePreview img');

      // For Edit Event modal
      setupImagePreview('editDropZone', 'editImage', '#editImagePreview img');
    </script>
    <script src="javascript/admin/mount_ui.js" type="module"></script>
    <script src="javascript/main.js"></script>

  </body>
  <!-- 
        █████ ███████████  ███████████     █████████   █████   █████ █████ ██████   ██████ ™
        ░███ ░░███░░░░░███░░███░░░░░███   ███░░░░░███ ░░███   ░░███ ░░███ ░░██████ ██████ 
        ░███  ░███    ░███ ░███    ░███  ░███    ░███  ░███    ░███  ░███  ░███░█████░███ 
        ░███  ░██████████  ░██████████   ░███████████  ░███████████  ░███  ░███░░███ ░███ 
        ░███  ░███░░░░░███ ░███░░░░░███  ░███░░░░░███  ░███░░░░░███  ░███  ░███ ░░░  ░███ 
        ░███  ░███    ░███ ░███    ░███  ░███    ░███  ░███    ░███  ░███  ░███      ░███ 
        █████ ███████████  █████   █████ █████   █████ █████   █████ █████ █████     █████
        ░░░░░ ░░░░░░░░░░░  ░░░░░   ░░░░░ ░░░░░   ░░░░░ ░░░░░   ░░░░░ ░░░░░ ░░░░░     ░░░░░ 
                                                                                                                                                                
        -->       
</html>
